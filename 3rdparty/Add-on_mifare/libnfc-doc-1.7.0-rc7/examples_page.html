<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libnfc: Examples</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libnfc
   &#160;<span id="projectnumber">1.7.0-rc7</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">libnfc reference manual</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="intro_sec"></a>
Introduction</h2>
<p>This page presents some examples to help developers which use <b>libnfc</b>.</p>
<h2><a class="anchor" id="example_1_sec"></a>
Simple tag UID reader.</h2>
<p>This short commented code example should be helpful to quick start development with <b>libnfc</b>, it grab the first available NFC device and print the first found ISO14443-A tag (e.g. MIFARE Classic, MIFARE Ultralight). </p>
<div class="fragment"><pre class="fragment">
<span class="comment">// To compile this simple example:</span>
<span class="comment">// $ gcc -o quick_start_example1 quick_start_example1.c -lnfc</span>

<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="nfc_8h.html" title="libnfc interface">nfc/nfc.h</a>&gt;</span>

<span class="keyword">static</span> <span class="keywordtype">void</span>
print_hex(<span class="keyword">const</span> uint8_t *pbtData, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szBytes)
{
  <span class="keywordtype">size_t</span>  szPos;

  <span class="keywordflow">for</span> (szPos = 0; szPos &lt; szBytes; szPos++) {
    printf(<span class="stringliteral">&quot;%02x  &quot;</span>, pbtData[szPos]);
  }
  printf(<span class="stringliteral">&quot;\n&quot;</span>);
}

<span class="keywordtype">int</span>
main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
{
  <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd;
  <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> nt;

  <span class="comment">// Allocate only a pointer to nfc_context</span>
  <a class="code" href="structnfc__context.html" title="NFC library context Struct which contains internal options, references, pointers, etc...">nfc_context</a> *context;

  <span class="comment">// Initialize libnfc and set the nfc_context</span>
  <a class="code" href="group__lib.html#gae494d97ba0cc10efda9065a07c8900a8" title="Initialize libnfc. This function must be called before calling any other libnfc function.">nfc_init</a>(&amp;context);
  <span class="keywordflow">if</span> (context == NULL) {
    printf(<span class="stringliteral">&quot;Unable to init libnfc (malloc)\n&quot;</span>);
    exit(EXIT_FAILURE);
  }

  <span class="comment">// Display libnfc version</span>
  <span class="keyword">const</span> <span class="keywordtype">char</span> *acLibnfcVersion = <a class="code" href="group__misc.html#gaa48f27c0f93d6508ad9a5ae01ab054d4" title="Returns the library version.">nfc_version</a>();
  (void)argc;
  printf(<span class="stringliteral">&quot;%s uses libnfc %s\n&quot;</span>, argv[0], acLibnfcVersion);

  <span class="comment">// Open, using the first available NFC device which can be in order of selection:</span>
  <span class="comment">//   - default device specified using environment variable or</span>
  <span class="comment">//   - first specified device in libnfc.conf (/etc/nfc) or</span>
  <span class="comment">//   - first specified device in device-configuration directory (/etc/nfc/devices.d) or</span>
  <span class="comment">//   - first auto-detected (if feature is not disabled in libnfc.conf) device</span>
  pnd = <a class="code" href="group__dev.html#ga9a0b9811c0e7f93e7474db82a1fb4501" title="Open a NFC device.">nfc_open</a>(context, NULL);

  <span class="keywordflow">if</span> (pnd == NULL) {
    printf(<span class="stringliteral">&quot;ERROR: %s&quot;</span>, <span class="stringliteral">&quot;Unable to open NFC device.&quot;</span>);
    exit(EXIT_FAILURE);
  }
  <span class="comment">// Set opened NFC device to initiator mode</span>
  <span class="keywordflow">if</span> (<a class="code" href="group__initiator.html#ga4cab5665c89d5be858147b1548c7af3f" title="Initialize NFC device as initiator (reader)">nfc_initiator_init</a>(pnd) &lt; 0) {
    <a class="code" href="group__error.html#ga00574f46e7c1bf30b18187329e417838" title="Display the last error occured on a nfc_device.">nfc_perror</a>(pnd, <span class="stringliteral">&quot;nfc_initiator_init&quot;</span>);
    exit(EXIT_FAILURE);
  }

  printf(<span class="stringliteral">&quot;NFC reader: %s opened\n&quot;</span>, <a class="code" href="group__data.html#gaf670d5fd4a55110803002be8972c4a97" title="Returns the device name.">nfc_device_get_name</a>(pnd));

  <span class="comment">// Poll for a ISO14443A (MIFARE) tag</span>
  <span class="keyword">const</span> <a class="code" href="structnfc__modulation.html" title="NFC modulation structure.">nfc_modulation</a> nmMifare = {
    .nmt = NMT_ISO14443A,
    .nbr = NBR_106,
  };
  <span class="keywordflow">if</span> (<a class="code" href="group__initiator.html#gacbe0fa197206cac99c83ed0152174811" title="Select a passive or emulated tag.">nfc_initiator_select_passive_target</a>(pnd, nmMifare, NULL, 0, &amp;nt) &gt; 0) {
    printf(<span class="stringliteral">&quot;The following (NFC) ISO14443A tag was found:\n&quot;</span>);
    printf(<span class="stringliteral">&quot;    ATQA (SENS_RES): &quot;</span>);
    print_hex(nt.nti.nai.abtAtqa, 2);
    printf(<span class="stringliteral">&quot;       UID (NFCID%c): &quot;</span>, (nt.nti.nai.abtUid[0] == 0x08 ? <span class="charliteral">&#39;3&#39;</span> : <span class="charliteral">&#39;1&#39;</span>));
    print_hex(nt.nti.nai.abtUid, nt.nti.nai.szUidLen);
    printf(<span class="stringliteral">&quot;      SAK (SEL_RES): &quot;</span>);
    print_hex(&amp;nt.nti.nai.btSak, 1);
    <span class="keywordflow">if</span> (nt.nti.nai.szAtsLen) {
      printf(<span class="stringliteral">&quot;          ATS (ATR): &quot;</span>);
      print_hex(nt.nti.nai.abtAts, nt.nti.nai.szAtsLen);
    }
  }
  <span class="comment">// Close NFC device</span>
  <a class="code" href="group__dev.html#ga391821649d656a2431a6d174a3db8b30" title="Close from a NFC device.">nfc_close</a>(pnd);
  <span class="comment">// Release the context</span>
  <a class="code" href="group__lib.html#gabd34e0cc381699d6aec73bf993105400" title="Deinitialize libnfc. Should be called after closing all open devices and before your application term...">nfc_exit</a>(context);
  exit(EXIT_SUCCESS);
}
</pre></div> </div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 5 2013 16:09:20 for libnfc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
